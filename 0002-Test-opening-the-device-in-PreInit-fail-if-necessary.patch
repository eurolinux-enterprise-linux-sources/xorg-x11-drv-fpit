From 33f7fda20bfd2cada09332ee6d1c544514f8fe4d Mon Sep 17 00:00:00 2001
From: Peter Hutterer <peter.hutterer@who-t.net>
Date: Tue, 19 Jul 2011 11:44:35 +1000
Subject: [PATCH 2/6] Test opening the device in PreInit, fail if necessary

Signed-off-by: Peter Hutterer <peter.hutterer@who-t.net>
---
 src/xf86Fpit.c |    8 ++++++++
 1 files changed, 8 insertions(+), 0 deletions(-)

diff --git a/src/xf86Fpit.c b/src/xf86Fpit.c
index e0f316b..3ab7297 100644
--- a/src/xf86Fpit.c
+++ b/src/xf86Fpit.c
@@ -569,6 +569,14 @@ static int xf86FpitInit(InputDriverPtr drv, InputInfoPtr pInfo, int flags)
 	if (!str) {
 		xf86Msg(X_ERROR, "%s: No Device specified in FPIT module config.\n", pInfo->name);
 		return BadValue;
+	} else {
+		pInfo->fd = xf86OpenSerial(pInfo->options);
+		if (pInfo->fd < 0) {
+		    xf86Msg(X_ERROR, "%s: Unable to open Fpit touchscreen device '%s'\n", pInfo->name, str);
+		    return BadValue;
+		}
+		xf86CloseSerial(pInfo->fd);
+		pInfo->fd = -1;
 	}
 	priv->fpitDev = strdup(str);
 	pInfo->name = xf86SetStrOption(pInfo->options, "DeviceName", XI_TOUCHSCREEN);
-- 
1.7.6

